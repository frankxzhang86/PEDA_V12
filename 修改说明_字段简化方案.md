# PEDA_V12 å­—æ®µç®€åŒ–æ–¹æ¡ˆ - ä¿®æ”¹è¯´æ˜

**ä¿®æ”¹æ—¶é—´:** 2025å¹´11æœˆ12æ—¥
**ä¿®æ”¹ä¸»é¢˜:** Excelä¸Šä¼ æ¨¡æ¿å­—æ®µè¦æ±‚ç®€åŒ–
**ä¿®æ”¹èŒƒå›´:** 8ä¸ªä¸»è¦ä»£ç æ–‡ä»¶ + æ¨¡æ¿ç”Ÿæˆå™¨

---

## ä¸€ã€ä¿®æ”¹æ¦‚è§ˆ

### åŸéœ€æ±‚
å°†Excelä¸Šä¼ å­—æ®µä»**8ä¸ªå¿…å¡«å­—æ®µ**ç®€åŒ–ä¸º**4ä¸ªå¿…å¡«å­—æ®µ + 3ä¸ªé€‰å¡«å­—æ®µ**ï¼Œå¹¶ç§»é™¤`document_maintenance_path`å­—æ®µï¼ˆæ”¹ä¸ºGUIä¸»é¡µè®¾ç½®ï¼‰ã€‚

### ä¿®æ”¹ç»“æœ
âœ… **æˆåŠŸå®Œæˆ** - æ‰€æœ‰ä»£ç é€»è¾‘å·²è°ƒæ•´ï¼Œç³»ç»Ÿç°å·²æ”¯æŒæ–°çš„å­—æ®µé…ç½®ã€‚

---

## äºŒã€æ–°çš„å­—æ®µé…ç½®

### å¿…å¡«å­—æ®µï¼ˆ4ä¸ªï¼Œä¸èƒ½ä¸ºç©ºï¼‰
1. **`part_number`** - é›¶ä»¶å·
2. **`reason`** - åŸå› ä»£ç 
3. **`decision_region`** - å†³ç­–åŒºåŸŸ
4. **`decision_value`** - å†³ç­–å€¼

### é€‰å¡«å­—æ®µï¼ˆ3ä¸ªï¼Œæœ‰é»˜è®¤å€¼ï¼‰
5. **`contact`** - è”ç³»äºº â†’ é»˜è®¤å€¼ï¼š`Pipar Pan`
6. **`project_type`** - é¡¹ç›®ç±»å‹ â†’ é»˜è®¤å€¼ï¼š`2`
7. **`sample_quantity`** - æ ·å“æ•°é‡ â†’ é»˜è®¤å€¼ï¼š`10`

### åˆ é™¤å­—æ®µ
- ~~`document_maintenance_path`~~ - æ”¹ä¸ºåœ¨GUIä¸»é¡µ"æ–‡æ¡£è·¯å¾„"å¤„è®¾ç½®
- ~~`external_info`~~ (å¦‚æœæœ‰)
- ~~`internal_comment`~~ (å¦‚æœæœ‰)

---

## ä¸‰ã€ä¿®æ”¹çš„æ–‡ä»¶è¯¦è§£

### 1. **config/constants.py** âœ…
**å˜æ›´å†…å®¹ï¼š**
- å°† `REQUIRED_COLUMNS` ä»8ä¸ªå­—æ®µå‡å°‘ä¸º4ä¸ªå¿…å¡«å­—æ®µ
- æ–°å¢ `ALL_COLUMNS` å¸¸é‡åŒ…å«æ‰€æœ‰7ä¸ªå­—æ®µï¼ˆå¿…å¡«+é€‰å¡«ï¼‰

**å…³é”®ä»£ç ï¼š**
```python
# Excelæ¨¡æ¿ä¸­å¿…éœ€çš„åˆ—åï¼ˆå¿…å¡«å­—æ®µï¼‰
REQUIRED_COLUMNS = [
    'part_number',
    'reason',
    'decision_region',
    'decision_value'
]

# Excelæ¨¡æ¿ä¸­æ‰€æœ‰å¯é€‰çš„åˆ—åï¼ˆåŒ…å«å¿…å¡«å’Œé€‰å¡«ï¼‰
ALL_COLUMNS = [
    'part_number',      # å¿…å¡«
    'reason',           # å¿…å¡«
    'decision_region',  # å¿…å¡«
    'decision_value',   # å¿…å¡«
    'contact',          # é€‰å¡«
    'project_type',     # é€‰å¡«
    'sample_quantity'   # é€‰å¡«
]
```

---

### 2. **modules/data_processor.py** âœ…
**å˜æ›´å†…å®¹ï¼š**
- æ›´æ–° `validate_excel_data()` å‡½æ•°
- åªæ£€æŸ¥4ä¸ªå¿…å¡«å­—æ®µä¸ä¸ºç©º
- é€‰å¡«å­—æ®µå…è®¸ä¸ºç©ºï¼ˆä¼šä½¿ç”¨é»˜è®¤å€¼ï¼‰

**å…³é”®é€»è¾‘ï¼š**
```python
# åªæ£€æŸ¥4ä¸ªå¿…å¡«å­—æ®µä¸ä¸ºç©º
qualified_df = df.dropna(subset=REQUIRED_COLUMNS)
```

---

### 3. **modules/peda_processor.py** âœ…
**å˜æ›´å†…å®¹ï¼š**

#### 3.1 `process_single_peda()` å‡½æ•°
- æ–°å¢å‚æ•°ï¼š`document_maintenance_path` ä»GUIä¼ å…¥
- æ•°æ®æå–æ”¹ä¸ºæŒ‰å¿…å¡«/é€‰å¡«åˆ†ç±»æå–
- é€‰å¡«å­—æ®µä½¿ç”¨é»˜è®¤å€¼

**æ–°ç­¾åï¼š**
```python
def process_single_peda(page: Page, data_row: Dict[str, Any], 
                       document_maintenance_path: str,  # æ–°å¢
                       log_callback: Optional[Callable] = None,
                       upload_record_callback: Optional[Callable] = None) -> bool:
```

**æ•°æ®æå–é€»è¾‘ï¼š**
```python
# å¿…å¡«å­—æ®µ
part_number = data_row.get('part_number', '')
reason = data_row.get('reason', '')
decision_region = data_row.get('decision_region', '')
decision_value = data_row.get('decision_value', '')

# é€‰å¡«å­—æ®µï¼ˆæä¾›é»˜è®¤å€¼ï¼‰
contact = data_row.get('contact', 'Pipar Pan')
project_type = data_row.get('project_type', '2')
sample_quantity = data_row.get('sample_quantity', '10')
```

#### 3.2 `validate_data_row()` å‡½æ•°
- åªéªŒè¯4ä¸ªå¿…å¡«å­—æ®µ
- ç§»é™¤å¯¹8ä¸ªå­—æ®µçš„éªŒè¯

#### 3.3 `prepare_data_row()` å‡½æ•°
- ä¸ºé€‰å¡«å­—æ®µæä¾›é»˜è®¤å€¼
- å»é™¤äº†å¯¹ `document_maintenance_path` çš„å¤„ç†

---

### 4. **interfaces/gui_interface.py** âœ…
**å˜æ›´å†…å®¹ï¼š**
- ä¿®æ”¹ `run_with_gui_params_v2()` å‡½æ•°
- æ–°å¢ä¼ é€’ `document_path` å‚æ•°ç»™æ‰¹å¤„ç†å‡½æ•°

**å…³é”®æ”¹åŠ¨ï¼š**
```python
result = run_batch_with_reuse(
    playwright=playwright,
    data_rows=data_rows,
    document_path=document_path,  # æ–°å¢ï¼šä¼ é€’æ–‡æ¡£è·¯å¾„
    username=username,
    # ... å…¶ä»–å‚æ•°
)
```

---

### 5. **core/workflow_engine.py** âœ…
**å˜æ›´å†…å®¹ï¼š**
- ä¿®æ”¹ `run_batch_with_reuse()` å‡½æ•°ç­¾å
- æ–°å¢ `document_path` å‚æ•°
- åœ¨è°ƒç”¨ `process_single_peda()` æ—¶ä¼ é€’ `document_path`

**æ–°ç­¾åï¼š**
```python
def run_batch_with_reuse(playwright: Playwright, data_rows: List[Dict[str, Any]], 
                        document_path: str,  # æ–°å¢
                        username: str, password: str, system_language: str = 'en',
                        # ... å…¶ä»–å‚æ•°
```

**è°ƒç”¨ä¿®æ”¹ï¼š**
```python
if process_single_peda(page, processed_row, document_path, log_callback, upload_record_callback):
    # ... å¤„ç†ç»“æœ
```

---

### 6. **generate_template.py** âœ…
**å˜æ›´å†…å®¹ï¼š**
- ç§»é™¤ `document_maintenance_path` åˆ—
- è°ƒæ•´æ¨¡æ¿ä»8åˆ—å˜ä¸º7åˆ—
- æ›´æ–°å­—æ®µè¯´æ˜å’Œåˆ—å®½

**æ–°æ¨¡æ¿å­—æ®µé¡ºåºï¼š**
```python
data_template = {
    "part_number": [...],       # å¿…å¡«
    "reason": [...],            # å¿…å¡«
    "decision_region": [...],   # å¿…å¡«
    "decision_value": [...],    # å¿…å¡«
    "contact": [...],           # é€‰å¡«
    "project_type": [...],      # é€‰å¡«
    "sample_quantity": [...]    # é€‰å¡«
}
```

**å­—æ®µè¯´æ˜æ›´æ–°ï¼š**
```
ã€å¿…å¡«ã€‘part_number - äº§å“æ–™å·
ã€å¿…å¡«ã€‘reason - åŸå› ä»£ç 
ã€å¿…å¡«ã€‘decision_region - å†³ç­–åŒºåŸŸ
ã€å¿…å¡«ã€‘decision_value - å†³ç­–å€¼
ã€é€‰å¡«ã€‘contact - è”ç³»äººï¼ˆé»˜è®¤ï¼šPipar Panï¼‰
ã€é€‰å¡«ã€‘project_type - é¡¹ç›®ç±»å‹ï¼ˆé»˜è®¤ï¼š2ï¼‰
ã€é€‰å¡«ã€‘sample_quantity - æ ·å“æ•°é‡ï¼ˆé»˜è®¤ï¼š10ï¼‰
```

---

### 7. **modules/form_handler.py** âœ…
**å˜æ›´å†…å®¹ï¼š**
- ç§»é™¤ä» `data_row` ä¸­è¯»å– `document_maintenance_path` çš„é€»è¾‘
- ç®€åŒ–å¤‡é€‰æ–¹æ¡ˆï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤è·¯å¾„
- ä¿ç•™ä¸»é€»è¾‘é€šè¿‡ `document_manager` è·å–è·¯å¾„

**æ”¹åŠ¨è¯´æ˜ï¼š**
```python
else:
    # å¤‡é€‰æ–¹æ¡ˆï¼šä½¿ç”¨é»˜è®¤è·¯å¾„ï¼ˆdocument_maintenance_path ä¸å†ä»Excelè¯»å–ï¼‰
    print("âš ï¸ è­¦å‘Šï¼šdocument_manager ä¸å¯ç”¨ï¼Œä½¿ç”¨é»˜è®¤è·¯å¾„")
    base_path = "C:\\OES\\AI\\PIMS_Automation\\IAM\\PEDA\\PEDA_Ducuments"
    pdf_save_dir = os.path.join(base_path, part_number)
```

---

### 8. **interfaces/cli_interface.py** âœ…
**å˜æ›´å†…å®¹ï¼š**
- CLIæ¥å£ä½¿ç”¨æ–°çš„éªŒè¯é€»è¾‘
- è‡ªåŠ¨ä½¿ç”¨ `REQUIRED_COLUMNS` çš„æ–°å®šä¹‰
- å…¼å®¹é€‰å¡«å­—æ®µçš„é»˜è®¤å€¼æœºåˆ¶

---

## å››ã€å…³é”®æ•°æ®æµå˜åŒ–

### åŸæµç¨‹ï¼ˆ8ä¸ªå­—æ®µï¼‰
```
Excelè¯»å–
  â†“
éªŒè¯8ä¸ªå¿…å¡«å­—æ®µ
  â†“
è¯»å–document_maintenance_path
  â†“
å¤„ç†PEDA
```

### æ–°æµç¨‹ï¼ˆ4ä¸ªå¿…å¡« + 3ä¸ªé€‰å¡«ï¼‰
```
Excelè¯»å–
  â†“
éªŒè¯4ä¸ªå¿…å¡«å­—æ®µ
  â†“
ä¸ºé€‰å¡«å­—æ®µæä¾›é»˜è®¤å€¼
  â†“
GUIè·å–document_path
  â†“
ä¼ é€’ç»™å¤„ç†å‡½æ•°
  â†“
å¤„ç†PEDA
```

---

## äº”ã€å‘åå…¼å®¹æ€§

âœ… **å…¼å®¹æ€§åˆ†æï¼š**

1. **æ—§Excelæ–‡ä»¶**ï¼šåŒ…å«æ›´å¤šå­—æ®µçš„Excelæ–‡ä»¶ä»ç„¶å¯ç”¨
   - å¤šä½™çš„åˆ—ä¼šè¢«å¿½ç•¥
   - åªéªŒè¯4ä¸ªå¿…å¡«å­—æ®µ

2. **é€‰å¡«å­—æ®µä¸ºç©ºçš„å¤„ç†**ï¼š
   - ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨é»˜è®¤å€¼
   - ä¸ä¼šå¯¼è‡´å¤„ç†å¤±è´¥

3. **CLIæ¨¡å¼**ï¼š
   - ä½¿ç”¨æ–°éªŒè¯é€»è¾‘
   - å…¼å®¹æ–°æ—§æ ¼å¼çš„Excel

---

## å…­ã€æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯
1. âœ… ç”Ÿæˆæ–°æ¨¡æ¿ï¼ˆ7åˆ—ï¼‰
2. âœ… ä¸Šä¼ åªåŒ…å«4ä¸ªå¿…å¡«å­—æ®µçš„Excel
3. âœ… ä¸Šä¼ åŒ…å«é€‰å¡«å­—æ®µï¼ˆéƒ¨åˆ†ä¸ºç©ºï¼‰çš„Excel
4. âœ… ä¸Šä¼ åŒ…å«æ—§æ ¼å¼å­—æ®µçš„Excelï¼ˆåº”è¯¥å¿½ç•¥å¤šä½™åˆ—ï¼‰
5. âœ… éªŒè¯é»˜è®¤å€¼æ˜¯å¦æ­£ç¡®åº”ç”¨
6. âœ… éªŒè¯æ–‡æ¡£è·¯å¾„ä»GUIè·å–

---

## ä¸ƒã€ä½¿ç”¨è¯´æ˜æ›´æ–°

### ç”¨æˆ·é¡»çŸ¥
- **ä¸‹è½½æ–°æ¨¡æ¿**ï¼šç‚¹å‡»"ä¸‹è½½æ¨¡æ¿"è·å–æœ€æ–°çš„7åˆ—æ¨¡æ¿
- **å¡«å†™Excel**ï¼šåªéœ€å¡«å†™4ä¸ªå¿…å¡«å­—æ®µï¼Œé€‰å¡«å­—æ®µå¯ç©ºç€
- **è®¾ç½®æ–‡æ¡£è·¯å¾„**ï¼šåœ¨GUIä¸»é¡µé€‰æ‹©"æ–‡æ¡£è·¯å¾„"ï¼Œä¸å†ä»Excelè¯»å–
- **é»˜è®¤å€¼**ï¼š
  - è”ç³»äººé»˜è®¤ä¸º "Pipar Pan"
  - é¡¹ç›®ç±»å‹é»˜è®¤ä¸º "2"
  - æ ·å“æ•°é‡é»˜è®¤ä¸º "10"

---

## å…«ã€æ–‡ä»¶å˜æ›´ç»Ÿè®¡

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | é‡è¦æ€§ |
|------|--------|-------|
| config/constants.py | ä¿®æ”¹ | ğŸ”´ å…³é”® |
| modules/data_processor.py | ä¿®æ”¹ | ğŸ”´ å…³é”® |
| modules/peda_processor.py | ä¿®æ”¹ | ğŸ”´ å…³é”® |
| interfaces/gui_interface.py | ä¿®æ”¹ | ğŸŸ  é‡è¦ |
| core/workflow_engine.py | ä¿®æ”¹ | ğŸŸ  é‡è¦ |
| generate_template.py | ä¿®æ”¹ | ğŸŸ  é‡è¦ |
| modules/form_handler.py | ä¿®æ”¹ | ğŸŸ¡ ä¸€èˆ¬ |
| interfaces/cli_interface.py | æ— éœ€ä¿®æ”¹ | ğŸŸ¢ è‡ªåŠ¨é€‚åº” |

---

## ä¹ã€æäº¤ä¿¡æ¯

```
commit: Simplify Excel upload template fields requirement

- Reduce required fields from 8 to 4
- Add optional fields with default values
- Remove document_maintenance_path from Excel (set in GUI instead)
- Update validation logic across all modules
- Generate new 7-column template
- Support backward compatibility with old Excel formats

Required fields (4):
  - part_number
  - reason
  - decision_region
  - decision_value

Optional fields (3 with defaults):
  - contact (default: Pipar Pan)
  - project_type (default: 2)
  - sample_quantity (default: 10)
```

---

**ä¿®æ”¹å®Œæˆæ—¶é—´:** 2025å¹´11æœˆ12æ—¥
**ä¿®æ”¹çŠ¶æ€:** âœ… æ‰€æœ‰æ›´æ”¹å·²å®Œæˆå¹¶å‡†å¤‡æäº¤
**ä¸‹ä¸€æ­¥:** æäº¤åˆ°è¿œç¨‹ä»“åº“ (git push)
